<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta name="description" content="Understanding the $36 Trillion U.S. Treasury Market - Who owns America's debt?">

    <title>U.S. Treasury Market Analysis | Franklin Hugh Money</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;500&family=Inter:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Plotly.js for visualizations -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>

    <style>
        :root {
            /* Primary Institutional Colors */
            --fh-navy: #002D62;
            --fh-cream: #FFFDF7;
            --fh-gray: #54585A;

            /* Secondary Colors */
            --fh-sage: #7C9885;
            --fh-burgundy: #6B2737;
            --fh-gold: #B08D57;

            /* Neutral Scale */
            --fh-gray-900: #1A1A1A;
            --fh-gray-700: #404040;
            --fh-gray-600: #595959;
            --fh-gray-500: #737373;
            --fh-gray-300: #D4D4D4;
            --fh-gray-200: #E5E5E5;
            --fh-gray-100: #F5F5F5;
            --fh-white: #FFFFFF;

            /* Typography */
            --fh-font-display: 'Crimson Pro', Georgia, serif;
            --fh-font-body: 'Inter', -apple-system, sans-serif;
            --fh-font-mono: 'IBM Plex Mono', monospace;

            /* Spacing */
            --fh-space-xs: 0.25rem;
            --fh-space-sm: 0.5rem;
            --fh-space-md: 1rem;
            --fh-space-lg: 1.5rem;
            --fh-space-xl: 2rem;
            --fh-space-2xl: 3rem;
            --fh-space-3xl: 4rem;
            --fh-space-4xl: 6rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--fh-font-body);
            font-size: 16px;
            line-height: 1.75;
            color: var(--fh-gray-900);
            background: var(--fh-cream);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Typography */
        h1, h2, h3 {
            font-family: var(--fh-font-display);
            font-weight: 400;
            line-height: 1.2;
        }

        h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            letter-spacing: -0.02em;
            color: var(--fh-navy);
            margin-bottom: var(--fh-space-xl);
        }

        h2 {
            font-size: clamp(1.5rem, 3vw, 2rem);
            margin-bottom: var(--fh-space-lg);
            color: var(--fh-navy);
            border-bottom: 2px solid var(--fh-navy);
            padding-bottom: var(--fh-space-sm);
        }

        h3 {
            font-size: clamp(1.25rem, 2vw, 1.5rem);
            margin-bottom: var(--fh-space-md);
            color: var(--fh-gray-700);
        }

        p {
            margin-bottom: var(--fh-space-md);
            color: var(--fh-gray-700);
            max-width: 65ch;
        }

        a {
            color: var(--fh-navy);
            text-decoration-thickness: 1px;
            text-underline-offset: 2px;
            transition: all 0.2s ease;
        }

        a:hover {
            text-decoration-thickness: 2px;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--fh-space-xl);
        }

        /* Header */
        .header {
            padding: var(--fh-space-2xl) 0;
            border-bottom: 1px solid var(--fh-gray-200);
            margin-bottom: var(--fh-space-2xl);
        }

        .nav {
            display: flex;
            gap: var(--fh-space-xl);
            margin-bottom: var(--fh-space-2xl);
            font-size: 0.9rem;
            letter-spacing: 0.01em;
        }

        .nav a {
            color: var(--fh-gray-600);
            text-decoration: none;
            text-transform: uppercase;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .nav a:hover {
            color: var(--fh-navy);
        }

        .nav .active {
            color: var(--fh-navy);
            font-weight: 600;
        }

        /* Lead Text */
        .lead {
            font-size: 1.25rem;
            font-family: var(--fh-font-display);
            color: var(--fh-gray-600);
            line-height: 1.6;
            margin-bottom: var(--fh-space-2xl);
        }

        /* Visualization Containers */
        .viz-section {
            margin-bottom: var(--fh-space-4xl);
            padding: var(--fh-space-2xl);
            background: var(--fh-white);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .viz-container {
            min-height: 500px;
            margin-top: var(--fh-space-xl);
        }

        .viz-description {
            font-size: 0.95rem;
            color: var(--fh-gray-600);
            margin-top: var(--fh-space-md);
            font-style: italic;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            margin: var(--fh-space-2xl) 0;
            border-collapse: collapse;
            font-family: var(--fh-font-mono);
            font-size: 0.9rem;
        }

        .data-table th,
        .data-table td {
            padding: var(--fh-space-md);
            text-align: left;
            border-bottom: 1px solid var(--fh-gray-200);
        }

        .data-table th {
            background: var(--fh-navy);
            color: var(--fh-white);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.85rem;
        }

        .data-table tr:hover {
            background: var(--fh-gray-100);
        }

        .data-table .amount {
            text-align: right;
            font-weight: 500;
        }

        .data-table .percentage {
            text-align: right;
            color: var(--fh-gray-600);
        }

        /* Insights Box */
        .insight-box {
            background: linear-gradient(135deg, var(--fh-navy) 0%, #003d82 100%);
            color: var(--fh-white);
            padding: var(--fh-space-2xl);
            border-radius: 8px;
            margin: var(--fh-space-2xl) 0;
        }

        .insight-box h3 {
            color: var(--fh-white);
            margin-bottom: var(--fh-space-lg);
        }

        .insight-box ul {
            list-style: none;
            padding: 0;
        }

        .insight-box li {
            padding-left: var(--fh-space-lg);
            margin-bottom: var(--fh-space-sm);
            position: relative;
        }

        .insight-box li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: var(--fh-gold);
        }

        /* Footer */
        .footer {
            margin-top: var(--fh-space-4xl);
            padding-top: var(--fh-space-2xl);
            border-top: 1px solid var(--fh-gray-200);
            text-align: center;
            font-size: 0.9rem;
            color: var(--fh-gray-500);
        }

        .footer a {
            color: var(--fh-gray-600);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: var(--fh-space-md);
            }

            .viz-section {
                padding: var(--fh-space-lg);
            }

            .nav {
                flex-wrap: wrap;
                gap: var(--fh-space-md);
            }

            .data-table {
                font-size: 0.8rem;
            }

            .data-table th,
            .data-table td {
                padding: var(--fh-space-sm);
            }
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: var(--fh-space-2xl);
            color: var(--fh-gray-500);
        }

        .loading:after {
            content: "...";
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60%, 100% { content: "..."; }
        }

        /* Enhanced Table Styles */
        .data-legend {
            display: flex;
            align-items: center;
            gap: var(--fh-space-xl);
            margin-bottom: var(--fh-space-lg);
            padding: var(--fh-space-md);
            background: var(--fh-gray-100);
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--fh-space-xs);
        }

        .control-btn {
            margin-left: auto;
            padding: var(--fh-space-xs) var(--fh-space-md);
            background: var(--fh-navy);
            color: var(--fh-white);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            background: #003d82;
            transform: translateY(-1px);
        }

        /* Expandable Row Styles */
        .data-table.enhanced {
            border-collapse: separate;
            border-spacing: 0;
        }

        .data-table.enhanced th {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .parent-row {
            background: var(--fh-gray-100);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .parent-row:hover {
            background: #e3e9f0;
        }

        .parent-row.expanded {
            background: #d9e2ed;
        }

        .child-row {
            background: var(--fh-white);
            font-size: 0.925rem;
            transition: all 0.3s ease;
        }

        .child-row.hidden {
            display: none;
        }

        .child-row td {
            border-left: 3px solid var(--fh-gray-200);
        }

        .child-row td:first-child {
            border-left: none;
        }

        .expand-icon {
            text-align: center;
            user-select: none;
            font-size: 0.9rem;
            color: var(--fh-gray-600);
        }

        .holder-name.indented {
            padding-left: 2rem;
            position: relative;
        }

        .holder-name.indented:before {
            content: "‚îî‚îÄ";
            position: absolute;
            left: 0.5rem;
            color: var(--fh-gray-400);
        }

        /* Verification Badges */
        .status-badge {
            font-size: 0.75rem;
            margin-left: var(--fh-space-sm);
            display: inline-block;
        }

        .status-verified {
            color: #2E7D32;
        }

        .status-estimated {
            color: #F57C00;
        }

        .source-note {
            font-size: 0.8rem;
            color: var(--fh-gray-600);
            font-style: italic;
        }

        /* YoY Change Indicators */
        .change {
            text-align: right;
            font-family: var(--fh-font-mono);
            font-size: 0.9rem;
        }

        .change.positive {
            color: #2E7D32;
        }

        .change.negative {
            color: #C62828;
        }

        .change.neutral {
            color: var(--fh-gray-500);
        }

        /* SIE Footnotes Section */
        .sie-footnotes {
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
            border: 1px solid #FFB74D;
            border-radius: 8px;
            padding: var(--fh-space-2xl);
            margin: var(--fh-space-2xl) 0;
        }

        .sie-footnotes h3 {
            color: #E65100;
            margin-bottom: var(--fh-space-lg);
            border-bottom: 2px solid #FFB74D;
            padding-bottom: var(--fh-space-sm);
        }

        .sie-note {
            margin-bottom: var(--fh-space-lg);
            padding: var(--fh-space-md);
            background: var(--fh-white);
            border-left: 4px solid #FF9800;
            border-radius: 4px;
        }

        .sie-note-title {
            font-weight: 600;
            color: #E65100;
            margin-bottom: var(--fh-space-sm);
            display: flex;
            align-items: center;
            gap: var(--fh-space-sm);
        }

        .sie-note-content {
            color: var(--fh-gray-700);
            line-height: 1.6;
        }

        .sie-note-content strong {
            color: #E65100;
            font-weight: 600;
        }

        /* Footnote References */
        .footnote-ref {
            color: #E65100;
            font-weight: 600;
            cursor: help;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <a href="index.html">‚Üê Home</a>
            <a href="#overview">Overview</a>
            <a href="#pie-chart">Pie Chart</a>
            <a href="#treemap">Treemap</a>
            <a href="#flow">Flow Diagram</a>
        </nav>

        <header class="header">
            <h1>Who Owns the $36 Trillion U.S. Treasury Market?</h1>
            <p class="lead">
                Understanding the distribution of U.S. government debt reveals the complex web of domestic and international stakeholders
                that finance America's operations. This analysis visualizes the December 2025 ownership structure of the world's largest bond market.
            </p>
        </header>

        <!-- Data Overview Table -->
        <section id="overview" class="viz-section">
            <h2>Ownership Breakdown</h2>

            <!-- Data Status Legend -->
            <div class="data-legend">
                <span class="legend-item">üü¢ <strong>Verified:</strong> Official government sources</span>
                <span class="legend-item">üü° <strong>Estimated:</strong> Industry reports & historical patterns</span>
                <button id="expandAllBtn" class="control-btn">Expand All</button>
            </div>

            <table class="data-table enhanced">
                <thead>
                    <tr>
                        <th width="5%"></th>
                        <th width="35%">Holder</th>
                        <th class="amount" width="15%">Amount</th>
                        <th class="percentage" width="10%">Share</th>
                        <th width="20%">Data Source</th>
                        <th class="change" width="15%">YoY Change</th>
                    </tr>
                </thead>
                <tbody id="dataTableBody">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </section>

        <!-- SIE Exam Key Concepts -->
        <section class="sie-footnotes">
            <h3>üéì SIE Exam Key Concepts</h3>
            <div id="sieNotesContainer">
                <!-- Will be populated by JavaScript -->
            </div>
        </section>

        <!-- Key Insights -->
        <div class="insight-box">
            <h3>Key Insights</h3>
            <ul>
                <li>The U.S. government itself holds 37.5% through the Federal Reserve and intragovernmental accounts</li>
                <li>Foreign holders control nearly a quarter (23.5%) of all U.S. debt</li>
                <li>Domestic private investors (mutual funds, banks, pensions) own 39% combined</li>
                <li>The Federal Reserve's $6.5T position makes it one of the largest single holders</li>
            </ul>
        </div>

        <!-- Pie Chart -->
        <section id="pie-chart" class="viz-section">
            <h2>Traditional Ownership View</h2>
            <div id="pieChart" class="viz-container">
                <div class="loading">Loading visualization</div>
            </div>
            <p class="viz-description">
                A classic pie chart showing the relative size of each holder category.
                The largest holders are emphasized with expanded slices.
            </p>
        </section>

        <!-- Treemap -->
        <section id="treemap" class="viz-section">
            <h2>Hierarchical Distribution</h2>
            <div id="treemapChart" class="viz-container">
                <div class="loading">Loading visualization</div>
            </div>
            <p class="viz-description">
                A space-efficient treemap visualization where each rectangle's area corresponds to the holder's share of the total debt.
            </p>
        </section>

        <!-- Sankey Diagram -->
        <section id="flow" class="viz-section">
            <h2>Ownership Flow Analysis</h2>
            <div id="sankeyChart" class="viz-container">
                <div class="loading">Loading visualization</div>
            </div>
            <p class="viz-description">
                This flow diagram traces how the $36 trillion in Treasury debt flows from issuance to three major categories
                (Government, Domestic Private, Foreign), then to specific holder types.
            </p>
        </section>

        <footer class="footer">
            <p>
                Data as of December 2025 | Analysis by <a href="index.html">Franklin Hugh Money</a>
            </p>
            <p>
                <small>An investment in knowledge pays the best interest.</small>
            </p>
        </footer>
    </div>

    <script>
        // Enhanced data structure with verified/estimated subcategories
        const treasuryHoldings = {
            metadata: {
                totalDebt: 36.0,
                asOf: "December 2024",
                sources: {
                    primary: "U.S. Treasury Bulletin Q3 2024",
                    foreign: "TIC Data October 2024",
                    federal: "Federal Reserve H.4.1 Release",
                    intragovt: "Monthly Statement of Public Debt"
                }
            },
            categories: {
                'Federal Reserve': {
                    total: 6.5,
                    status: 'verified',
                    source: 'SOMA Holdings Report',
                    yoyChange: '+2.3%',
                    breakdown: {
                        'Bills (< 1 year)': { amount: 0.4, status: 'verified', change: '+0.3%' },
                        'Notes (1-10 years)': { amount: 4.2, status: 'verified', change: '+1.8%' },
                        'Bonds (10-30 years)': { amount: 1.6, status: 'verified', change: '+0.2%' },
                        'TIPS (Inflation-Protected)': { amount: 0.3, status: 'verified', change: '0.0%' }
                    },
                    sieNote: "The Federal Reserve conducts Open Market Operations (OMO) through 23 authorized Primary Dealers. Treasury purchases are a key tool of monetary policy. Know the difference between monetary policy (Fed) and fiscal policy (Congress/Treasury)."
                },
                'Intragovernmental Holdings': {
                    total: 6.8,
                    status: 'verified',
                    source: 'Treasury MSPD',
                    yoyChange: '+1.8%',
                    breakdown: {
                        'Social Security Trust Fund': { amount: 2.9, status: 'verified', change: '+0.8%' },
                        'Medicare Trust Funds': { amount: 0.4, status: 'verified', change: '+0.1%' },
                        'Federal Retirement Funds': { amount: 1.8, status: 'verified', change: '+0.5%' },
                        'Other Government Accounts': { amount: 1.7, status: 'verified', change: '+0.4%' }
                    },
                    sieNote: "Government Account Series (GAS) securities are non-marketable and cannot be traded. Trust funds are legally required to invest surpluses in special-issue Treasury securities. These holdings represent IOUs from one part of government to another."
                },
                'Foreign Official Holders': {
                    total: 8.5,
                    status: 'verified',
                    source: 'TIC Data Oct 2024',
                    yoyChange: '-0.5%',
                    breakdown: {
                        'Japan': { amount: 1.13, status: 'verified', change: '-0.2%' },
                        'China': { amount: 0.77, status: 'verified', change: '-0.8%' },
                        'United Kingdom': { amount: 0.75, status: 'verified', change: '+0.3%' },
                        'Luxembourg': { amount: 0.41, status: 'verified', change: '+0.1%' },
                        'Belgium': { amount: 0.36, status: 'verified', change: '+0.2%' },
                        'Ireland': { amount: 0.33, status: 'verified', change: '+0.1%' },
                        'Canada': { amount: 0.32, status: 'verified', change: '0.0%' },
                        'Cayman Islands': { amount: 0.31, status: 'verified', change: '+0.4%' },
                        'Switzerland': { amount: 0.30, status: 'verified', change: '-0.1%' },
                        'France': { amount: 0.28, status: 'verified', change: '+0.1%' },
                        'All Other Countries': { amount: 3.54, status: 'verified', change: '-0.6%' }
                    },
                    sieNote: "U.S. Treasuries are considered risk-free in USD terms and serve as reserve assets for foreign central banks. The 'petrodollar' system and trade surpluses drive foreign Treasury accumulation. Note: Cayman Islands holdings often represent hedge fund custody accounts."
                },
                'U.S. Mutual Funds & ETFs': {
                    total: 6.8,
                    status: 'verified',
                    source: 'Fed Z.1 Report',
                    yoyChange: '+1.2%',
                    breakdown: {
                        'Bond Mutual Funds': { amount: 3.1, status: 'estimated', change: '+0.5%', basis: 'ICI data' },
                        'Money Market Funds': { amount: 2.2, status: 'estimated', change: '+0.4%', basis: 'ICI data' },
                        'Treasury ETFs': { amount: 1.0, status: 'estimated', change: '+0.2%', basis: 'ETF.com' },
                        'Target-Date Funds': { amount: 0.5, status: 'estimated', change: '+0.1%', basis: 'Morningstar' }
                    },
                    sieNote: "Money Market Funds must maintain stable $1.00 NAV and invest in securities maturing in 397 days or less. Treasury ETFs trade on exchanges with intraday pricing, unlike mutual funds which price once daily at NAV. Know the difference between open-end funds, closed-end funds, and ETFs."
                },
                'U.S. Banks & Depositories': {
                    total: 4.5,
                    status: 'verified',
                    source: 'FDIC Banking Profile',
                    yoyChange: '-0.8%',
                    breakdown: {
                        'Large Commercial Banks (>$250B)': { amount: 2.8, status: 'estimated', change: '-0.5%', basis: 'FDIC' },
                        'Regional Banks ($10-250B)': { amount: 1.1, status: 'estimated', change: '-0.2%', basis: 'FDIC' },
                        'Community Banks (<$10B)': { amount: 0.4, status: 'estimated', change: '-0.1%', basis: 'FDIC' },
                        'Savings Institutions & Credit Unions': { amount: 0.2, status: 'estimated', change: '0.0%', basis: 'NCUA' }
                    },
                    sieNote: "Banks classify Treasuries as either Held-to-Maturity (HTM) at amortized cost or Available-for-Sale (AFS) at fair value. Under Basel III, Treasuries qualify as High-Quality Liquid Assets (HQLA) with 0% risk weighting. The 2023 regional bank crisis highlighted duration risk in HTM portfolios."
                },
                'Pension Funds': {
                    total: 2.5,
                    status: 'verified',
                    source: 'Fed Z.1 Report',
                    yoyChange: '+0.6%',
                    breakdown: {
                        'State & Local Government': { amount: 1.4, status: 'estimated', change: '+0.3%', basis: 'Census' },
                        'Corporate Defined Benefit': { amount: 0.7, status: 'estimated', change: '+0.2%', basis: 'DOL' },
                        'Corporate Defined Contribution': { amount: 0.4, status: 'estimated', change: '+0.1%', basis: 'DOL' }
                    },
                    sieNote: "ERISA establishes fiduciary standards for private pension plans. Defined Benefit plans use Liability-Driven Investing (LDI) with Treasuries for duration matching. 401(k) plans are Defined Contribution where investment risk shifts to participants."
                },
                'Insurance/State/Local/Other': {
                    total: 2.0,
                    status: 'verified',
                    source: 'Various Sources',
                    yoyChange: '+0.3%',
                    breakdown: {
                        'Life Insurance Companies': { amount: 0.9, status: 'estimated', change: '+0.2%', basis: 'NAIC' },
                        'Property & Casualty Insurers': { amount: 0.3, status: 'estimated', change: '0.0%', basis: 'NAIC' },
                        'State & Local Governments': { amount: 0.5, status: 'estimated', change: '+0.1%', basis: 'Census' },
                        'Other Institutional': { amount: 0.3, status: 'estimated', change: '0.0%', basis: 'Residual' }
                    },
                    sieNote: "Insurance companies use Asset-Liability Management (ALM) to match policy durations. Life insurers hold longer-duration Treasuries than P&C insurers. State regulations often mandate minimum Treasury allocations. General Account assets back guarantees; Separate Accounts shift risk to policyholders."
                }
            }
        };

        // Legacy data format for existing visualizations
        const data = {};
        const percentages = {};

        for (const [key, value] of Object.entries(treasuryHoldings.categories)) {
            data[key] = value.total;
            percentages[key] = (value.total / 36.0) * 100;
        }

        // Color scheme matching the site design
        const colors = {
            'Federal Reserve': '#002D62',  // Navy
            'Intragovernmental Holdings': '#4A6FA5',  // Lighter navy
            'Foreign Official Holders': '#B08D57',  // Gold
            'U.S. Mutual Funds & ETFs': '#2E7D32',  // Deep green
            'U.S. Banks & Depositories': '#43A047',  // Medium green
            'Pension Funds': '#66BB6A',  // Light green
            'Insurance/State/Local/Other': '#7C9885'  // Sage
        };

        // Enhanced table population with expandable rows
        function populateEnhancedTable() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = ''; // Clear existing content

            let footnoteCounter = 1;
            const sieNotes = [];

            // Sort categories by total amount
            const sortedCategories = Object.entries(treasuryHoldings.categories)
                .sort((a, b) => b[1].total - a[1].total);

            sortedCategories.forEach(([categoryName, categoryData]) => {
                const categoryId = categoryName.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();

                // Create parent row
                const parentRow = tbody.insertRow();
                parentRow.className = 'parent-row';
                parentRow.dataset.category = categoryId;

                const statusBadge = categoryData.status === 'verified' ? 'üü¢' : 'üü°';
                const changeClass = getChangeClass(categoryData.yoyChange);

                parentRow.innerHTML = `
                    <td class="expand-icon">‚ñº</td>
                    <td class="holder-name">
                        ${categoryName}
                        <span class="status-badge">${statusBadge}</span>
                        <sup class="footnote-ref">[${footnoteCounter}]</sup>
                    </td>
                    <td class="amount">$${categoryData.total.toFixed(1)}T</td>
                    <td class="percentage">${((categoryData.total / 36.0) * 100).toFixed(1)}%</td>
                    <td class="source-note">${categoryData.source}</td>
                    <td class="change ${changeClass}">${categoryData.yoyChange}</td>
                `;

                // Store SIE note for later
                sieNotes.push({
                    number: footnoteCounter,
                    title: categoryName,
                    content: categoryData.sieNote
                });
                footnoteCounter++;

                // Create child rows
                if (categoryData.breakdown) {
                    Object.entries(categoryData.breakdown).forEach(([subName, subData]) => {
                        const childRow = tbody.insertRow();
                        childRow.className = 'child-row';
                        childRow.dataset.parent = categoryId;

                        const subStatusBadge = subData.status === 'verified' ? 'üü¢' : 'üü°';
                        const subChangeClass = getChangeClass(subData.change);
                        const sourceText = subData.basis || 'Verified';

                        childRow.innerHTML = `
                            <td></td>
                            <td class="holder-name indented">
                                ${subName}
                                <span class="status-badge">${subStatusBadge}</span>
                            </td>
                            <td class="amount">$${subData.amount.toFixed(2)}T</td>
                            <td class="percentage">${((subData.amount / 36.0) * 100).toFixed(2)}%</td>
                            <td class="source-note">${sourceText}</td>
                            <td class="change ${subChangeClass}">${subData.change}</td>
                        `;
                    });
                }
            });

            // Add total row
            const totalRow = tbody.insertRow();
            totalRow.style.fontWeight = 'bold';
            totalRow.style.borderTop = '2px solid var(--fh-navy)';
            totalRow.innerHTML = `
                <td></td>
                <td>TOTAL U.S. TREASURY DEBT</td>
                <td class="amount">$36.0T</td>
                <td class="percentage">100.0%</td>
                <td colspan="2"></td>
            `;

            // Populate SIE notes
            populateSIENotes(sieNotes);
        }

        // Helper function to determine change class
        function getChangeClass(changeStr) {
            if (!changeStr) return 'neutral';
            if (changeStr.startsWith('+')) return 'positive';
            if (changeStr.startsWith('-')) return 'negative';
            return 'neutral';
        }

        // Populate SIE exam notes
        function populateSIENotes(notes) {
            const container = document.getElementById('sieNotesContainer');
            if (!container) return;

            container.innerHTML = notes.map(note => `
                <div class="sie-note">
                    <div class="sie-note-title">
                        <span>[${note.number}]</span>
                        ${note.title}
                    </div>
                    <div class="sie-note-content">
                        ${note.content}
                    </div>
                </div>
            `).join('');
        }

        // Setup table interactivity
        function setupTableInteractivity() {
            // Parent row click to expand/collapse
            document.querySelectorAll('.parent-row').forEach(row => {
                row.addEventListener('click', function() {
                    const category = this.dataset.category;
                    const children = document.querySelectorAll(`[data-parent="${category}"]`);
                    const icon = this.querySelector('.expand-icon');

                    children.forEach(child => {
                        child.classList.toggle('hidden');
                    });

                    this.classList.toggle('expanded');
                    icon.textContent = icon.textContent === '‚ñº' ? '‚ñ∂' : '‚ñº';
                });
            });

            // Expand/Collapse All button
            const expandBtn = document.getElementById('expandAllBtn');
            if (expandBtn) {
                expandBtn.addEventListener('click', function() {
                    const isExpanding = this.textContent === 'Expand All';

                    document.querySelectorAll('.parent-row').forEach(row => {
                        const category = row.dataset.category;
                        const children = document.querySelectorAll(`[data-parent="${category}"]`);
                        const icon = row.querySelector('.expand-icon');

                        if (isExpanding) {
                            children.forEach(child => child.classList.remove('hidden'));
                            row.classList.add('expanded');
                            icon.textContent = '‚ñº';
                        } else {
                            children.forEach(child => child.classList.add('hidden'));
                            row.classList.remove('expanded');
                            icon.textContent = '‚ñ∂';
                        }
                    });

                    this.textContent = isExpanding ? 'Collapse All' : 'Expand All';
                });
            }
        }

        // 1. Pie Chart
        function createPieChart() {
            const sortedData = Object.entries(data).sort((a, b) => b[1] - a[1]);

            const pieData = [{
                values: sortedData.map(d => d[1]),
                labels: sortedData.map(([k, v]) => `${k}<br>$${v.toFixed(1)}T`),
                type: 'pie',
                hole: 0,
                textposition: 'outside',
                textinfo: 'label+percent',
                marker: {
                    colors: sortedData.map(d => colors[d[0]] || '#999999'),
                    line: {
                        color: '#FFFFFF',
                        width: 2
                    }
                },
                pull: sortedData.map((_, i) => i < 3 ? 0.1 : 0),
                hovertemplate: '<b>%{label}</b><br>%{percent}<br>$%{value:.1f} Trillion<extra></extra>'
            }];

            const layout = {
                height: 600,
                font: {
                    family: 'Inter, -apple-system, sans-serif'
                },
                showlegend: false,
                margin: { l: 100, r: 100, t: 50, b: 50 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            // Clear loading message before creating chart
            const container = document.getElementById('pieChart');
            if (container) {
                container.innerHTML = '';
            }

            Plotly.newPlot('pieChart', pieData, layout, {responsive: true});
        }

        // 2. Treemap
        function createTreemap() {
            const labels = Object.keys(data);
            const values = Object.values(data);
            // Combine the label and values into a single text string to avoid duplication
            const text = labels.map(k => `${k}<br>$${data[k].toFixed(1)}T<br>${percentages[k].toFixed(1)}%`);

            const treemapData = [{
                type: 'treemap',
                labels: labels,
                parents: Array(labels.length).fill(""),
                values: values,
                text: text,
                textposition: 'middle center',
                textinfo: 'text',  // Only show the custom text, not the label
                marker: {
                    colors: labels.map(l => colors[l] || '#999999'),
                    line: {
                        color: '#FFFFFF',
                        width: 2
                    }
                },
                hovertemplate: '<b>%{label}</b><br>Value: $%{value:.1f} Trillion<br>Share: %{percentroot}<extra></extra>',
                textfont: {
                    family: 'Inter, -apple-system, sans-serif',
                    size: 14
                }
            }];

            const layout = {
                height: 500,
                margin: { l: 0, r: 0, t: 0, b: 0 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            // Clear loading message before creating chart
            const container = document.getElementById('treemapChart');
            if (container) {
                container.innerHTML = '';
            }

            Plotly.newPlot('treemapChart', treemapData, layout, {responsive: true});
        }

        // 3. Enhanced Sankey Diagram with subcategories
        function createSankey() {
            // Build nodes array with subcategories
            const nodes = [];
            const nodeColors = [];
            const links = [];

            // Main source node
            nodes.push("U.S. Treasury Debt<br>$36T");
            nodeColors.push('#808080');

            // Category groupings
            nodes.push("U.S. Government<br>$13.3T (36.9%)");  // 1
            nodes.push("Domestic Private<br>$14.2T (39.4%)");  // 2
            nodes.push("Foreign Holders<br>$8.5T (23.6%)");   // 3
            nodeColors.push('#002D62', '#2E7D32', '#B08D57');

            let nodeIndex = 4;
            const categoryIndices = {};

            // Add main categories and their subcategories
            const govCategories = ['Federal Reserve', 'Intragovernmental Holdings'];
            const domesticCategories = ['U.S. Mutual Funds & ETFs', 'U.S. Banks & Depositories',
                                      'Pension Funds', 'Insurance/State/Local/Other'];

            // Government categories
            govCategories.forEach(cat => {
                const catData = treasuryHoldings.categories[cat];
                nodes.push(`${cat}<br>$${catData.total.toFixed(1)}T`);
                nodeColors.push('#002D62');
                categoryIndices[cat] = nodeIndex++;
                links.push({
                    source: 1,
                    target: categoryIndices[cat],
                    value: catData.total
                });
            });

            // Domestic categories
            domesticCategories.forEach(cat => {
                const catData = treasuryHoldings.categories[cat];
                nodes.push(`${cat}<br>$${catData.total.toFixed(1)}T`);
                nodeColors.push('#2E7D32');
                categoryIndices[cat] = nodeIndex++;
                links.push({
                    source: 2,
                    target: categoryIndices[cat],
                    value: catData.total
                });
            });

            // Foreign category
            const foreignData = treasuryHoldings.categories['Foreign Official Holders'];
            nodes.push(`Foreign Official<br>$${foreignData.total.toFixed(1)}T`);
            nodeColors.push('#B08D57');
            categoryIndices['Foreign Official Holders'] = nodeIndex++;
            links.push({
                source: 3,
                target: categoryIndices['Foreign Official Holders'],
                value: foreignData.total
            });

            // Add top 5 foreign countries as subcategories
            const topForeignCountries = Object.entries(foreignData.breakdown)
                .slice(0, 5)
                .filter(([name, _]) => name !== 'All Other Countries');

            topForeignCountries.forEach(([country, countryData]) => {
                nodes.push(`${country}<br>$${countryData.amount.toFixed(2)}T`);
                nodeColors.push('#D4A76A');
                links.push({
                    source: categoryIndices['Foreign Official Holders'],
                    target: nodeIndex++,
                    value: countryData.amount
                });
            });

            // Main flow links
            links.unshift(
                { source: 0, target: 1, value: 13.3 },
                { source: 0, target: 2, value: 14.2 },
                { source: 0, target: 3, value: 8.5 }
            );

            const sankeyData = {
                type: "sankey",
                orientation: "h",
                node: {
                    pad: 15,
                    thickness: 25,
                    line: {
                        color: "white",
                        width: 1
                    },
                    label: nodes,
                    color: nodeColors,
                    hovertemplate: '%{label}<extra></extra>'
                },
                link: {
                    source: links.map(l => l.source),
                    target: links.map(l => l.target),
                    value: links.map(l => l.value),
                    color: 'rgba(0,0,0,0.15)',
                    hovertemplate: '$%{value:.2f} Trillion<extra></extra>'
                }
            };

            const layout = {
                height: 600,
                font: {
                    family: 'Inter, -apple-system, sans-serif',
                    size: 12
                },
                margin: { l: 10, r: 10, t: 10, b: 10 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            // Clear loading message before creating chart
            const container = document.getElementById('sankeyChart');
            if (container) {
                container.innerHTML = '';
            }

            Plotly.newPlot('sankeyChart', [sankeyData], layout, {responsive: true});
        }

        // Initialize all visualizations
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded. Checking for Plotly...');

            // Check if Plotly is loaded
            if (typeof Plotly === 'undefined') {
                console.error('Plotly is not defined! CDN may be blocked or failed to load.');
                document.querySelectorAll('.loading').forEach(el => {
                    el.innerHTML = '<span style="color: red;">Error: Plotly.js library failed to load. This may be due to:<br>‚Ä¢ Network/firewall blocking CDN<br>‚Ä¢ Ad blocker interference<br>‚Ä¢ Browser security settings<br>Please check console for details.</span>';
                });
                return;
            }

            console.log('Plotly loaded successfully:', typeof Plotly);

            try {
                populateEnhancedTable();
                setupTableInteractivity();
            } catch (error) {
                // Silently handle error in production
                console.error('Table initialization error:', error);
            }

            // Create visualizations with slight delay for smooth loading
            setTimeout(() => {
                try {
                    createPieChart();
                } catch (error) {
                    console.error('Pie Chart Error:', error);
                    document.getElementById('pieChart').innerHTML =
                        '<div class="loading" style="color: red;">Error loading pie chart: ' + error.message + '</div>';
                }
            }, 100);

            setTimeout(() => {
                try {
                    createTreemap();
                } catch (error) {
                    console.error('Treemap Error:', error);
                    document.getElementById('treemapChart').innerHTML =
                        '<div class="loading" style="color: red;">Error loading treemap: ' + error.message + '</div>';
                }
            }, 200);

            setTimeout(() => {
                try {
                    createSankey();
                } catch (error) {
                    console.error('Sankey Error:', error);
                    document.getElementById('sankeyChart').innerHTML =
                        '<div class="loading" style="color: red;">Error loading flow diagram: ' + error.message + '</div>';
                }
            }, 300);
        });

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>